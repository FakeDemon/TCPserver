# TCP server 

## 0.0

单线程，阻塞IO

## 1.0
基于 C++17 实现单线程事件驱动 TCP Server，采用 Reactor 模型与 epoll 边缘触发 (ET) 处理多客户端连接

## 2.0
引入 Connection 对象和可扩展 Buffer，解决半包/粘包问题

增加了`client.cpp`，提供简单的测试客户端

### 新增特性
- **Connection 管理**：使用 `std::unordered_map<int, Connection>` 管理每个客户端连接的状态
- **双向缓冲区**：每个连接独立的输入(`in`)和输出(`out`)缓冲区，支持动态扩展
- **长度前缀协议**：4 字节网络序长度头 + payload，确保消息完整性
- **半包处理**：缓冲区自动积累数据，直到完整消息到达才处理
- **粘包处理**：循环解析缓冲区，逐条提取完整消息
- **缓冲区压缩**：已读数据超过总大小 50% 时自动清理，避免内存浪费
- **分离读写逻辑**：`handle_read()` 和 `handle_write()` 独立处理，支持非阻塞写回压
- **EPOLLOUT 按需监听**：写缓冲区有数据时才监听 `EPOLLOUT`，减少无效唤醒
- **异常连接清理**：通过 `EPOLLRDHUP` / `EPOLLERR` / `EPOLLHUP` 及时检测并清理异常连接
- **消息大小限制**：64KB 上限，防止恶意超大消息攻击

### 协议格式
```
[4 字节长度(网络序)] + [消息内容]
```

### 核心改进
- 彻底解决 TCP 流式协议的半包/粘包问题
